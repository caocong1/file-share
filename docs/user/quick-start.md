# 快速开始指南 🚀

## 一键启动

```bash
# 1. 安装依赖
pnpm install

# 2. 开发模式（推荐）
npm run dev

# 3. 生产模式（使用 PM2）
npm run prod
```

## 访问应用
- **Web 界面**: http://localhost:3000
- **服务状态**: http://localhost:3001/status

## 基本使用

### 1. 设置用户 ID
- 在界面中输入您的用户 ID（如：alice、bob）
- 用户 ID 用于标识您的设备

### 2. 连接其他设备
有两种连接方式：

**方法一：扫描局域网设备（推荐）**
1. 点击"扫描局域网设备"
2. 系统自动发现同网段设备
3. 从在线用户列表中选择目标设备并连接

**方法二：直接连接**
1. 输入对方的用户 ID
2. 点击"连接"按钮建立连接

### 3. 传输文件
连接成功后，可以使用以下方式传输文件：

- 🖱️ **拖拽**：将文件拖拽到传输区域
- 📁 **点击选择**：点击选择文件按钮
- ⌨️ **快捷键粘贴**：
  - Windows/Linux: `Ctrl+V`
  - Mac: `⌘+V` (Command+V)
  - 移动设备: 长按粘贴选项

## 📋 粘贴文件功能使用指南

### 🎯 功能概述
新增的 Ctrl+V 粘贴功能让文件传输更加便捷，支持直接粘贴剪贴板中的文件。

### 🖱️ 使用方法

#### 方法一：复制文件后粘贴
1. 在文件管理器中右键点击文件，选择"复制"
2. 切换到浏览器中的文件传输页面
3. 按快捷键粘贴：
   - **Windows/Linux**: `Ctrl+V`
   - **Mac**: `⌘+V` (Command+V)
   - **移动设备**: 长按粘贴选项
4. 文件将自动开始传输

#### 方法二：截图后粘贴
1. 使用截图工具：
   - **Windows**: Print Screen、Snipping Tool、Win+Shift+S
   - **Mac**: Cmd+Shift+4、Cmd+Shift+3
   - **Linux**: Screenshot、Spectacle、Flameshot
2. 切换到浏览器中的文件传输页面
3. 按对应系统的粘贴快捷键
4. 截图将自动保存为文件并传输

#### 方法三：从其他应用复制
1. 在图片编辑软件、Office文档等应用中复制内容
2. 切换到浏览器中的文件传输页面
3. 按对应系统的粘贴快捷键
4. 内容将转换为文件并传输

### ✨ 视觉反馈

- **高亮提示**：按下 Ctrl/Cmd+V 时，粘贴提示文字会短暂高亮
- **动画效果**：成功粘贴文件时，传输区域会显示激活动画
- **控制台日志**：在开发者工具中可以看到粘贴文件的详细信息

### 📝 支持的文件类型

- ✅ **图片文件**：PNG、JPG、GIF、BMP、WebP 等
- ✅ **文档文件**：PDF、DOC、TXT、HTML 等
- ✅ **截图内容**：系统截图工具生成的图片
- ✅ **复制的文件**：从文件管理器复制的任意文件
- ❌ **文件夹/目录**：由于浏览器安全限制，无法直接传输

### ⚠️ 文件夹传输限制

#### 问题说明
由于浏览器的安全限制，Clipboard API 和 File API 无法直接处理文件夹：

- **粘贴限制**: 复制文件夹后粘贴，系统会检测并警告
- **拖拽限制**: 拖拽文件夹到传输区域时会被阻止
- **API限制**: 浏览器不允许网页直接访问文件夹结构

#### 🛠️ 解决方案

1. **选择文件夹内容**:
   - 打开文件夹
   - 全选其中的文件 (Ctrl+A / Cmd+A)
   - 复制或拖拽选中的文件

2. **逐个传输**:
   - 分批选择文件夹中的文件
   - 支持多文件同时传输

3. **压缩传输**:
   - 将文件夹压缩为ZIP文件
   - 传输压缩包
   - 接收方解压缩

## 📋 可用脚本

### 开发模式
| 命令 | 说明 |
|------|------|
| `npm start` | 同时启动 Web 服务器(3000) 和信令服务器(3001) |
| `npm run dev` | 开发模式启动，带颜色标识的日志输出 |
| `npm run web` | 仅启动 Web 服务器 (端口 3000) |
| `npm run signal` | 仅启动 WebSocket 信令服务器 (端口 3001) |

### PM2 生产模式
| 命令 | 说明 |
|------|------|
| `npm run prod` | 生产模式启动（使用 PM2） |
| `npm run pm2:start` | 启动 PM2 应用 |
| `npm run pm2:stop` | 停止 PM2 应用 |
| `npm run pm2:restart` | 重启 PM2 应用 |
| `npm run pm2:reload` | 无缝重载 PM2 应用 |
| `npm run pm2:delete` | 删除 PM2 应用 |
| `npm run pm2:logs` | 查看 PM2 日志 |
| `npm run pm2:status` | 查看 PM2 状态 |
| `npm run pm2:monit` | PM2 监控界面 |

## 🔧 服务器配置

### 端口配置
- **Web 服务器**: 默认端口 3000
- **信令服务器**: 默认端口 3001

可以通过环境变量自定义端口：
```bash
# 自定义 Web 服务器端口
WEB_PORT=8080 npm run web

# 自定义信令服务器端口
PORT=8001 npm run signal

# 自定义主机地址
HOST=0.0.0.0 npm start
```

### 跨设备连接
如果需要局域网内其他设备访问：

1. 获取本机 IP 地址
2. 使用 IP 地址访问：`http://192.168.1.100:3000`
3. 或通过 URL 参数指定信令服务器：
   ```
   http://192.168.1.100:3000?server=192.168.1.100:3001
   ```

## 💡 使用技巧

1. **快速截图传输**：截图后立即按 Ctrl+V，一步到位
2. **批量复制**：可以在文件管理器中同时选择多个文件复制
3. **图片编辑**：在图片编辑软件中编辑完成后，直接复制粘贴传输
4. **文档分享**：在Office软件中复制内容，粘贴传输给其他人

## 🚀 PM2 生产环境部署

### PM2 介绍
PM2 是一个生产级的 Node.js 进程管理器，具有以下特性：
- 🔄 自动重启
- 📊 性能监控
- 📝 日志管理
- ⚡ 零停机时间重载
- 🔧 集群模式支持

### 快速开始
```bash
# 安装 PM2（如果尚未安装）
npm install

# 生产模式启动
npm run prod

# 查看应用状态
npm run pm2:status
```

### 日志文件位置
```
logs/
├── web-error.log          # Web 服务器错误日志
├── web-out.log           # Web 服务器输出日志
├── web-combined.log      # Web 服务器合并日志
├── signal-error.log      # 信令服务器错误日志
├── signal-out.log        # 信令服务器输出日志
└── signal-combined.log   # 信令服务器合并日志
```

### 性能监控

PM2 提供了强大的监控功能：

```bash
# Web 界面监控（需要 PM2 Plus）
pm2 web

# 命令行监控
npm run pm2:monit

# 查看详细信息
pm2 show file-share-web
pm2 show file-share-signal
```

---

**下一步：** 查看 [配置说明](configuration.md) 了解更多服务器和网络配置选项。 